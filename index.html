<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Family Hitster</title>
    <style>
        :root { --brand: #ff2d55; --bg: #121212; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: white; text-align: center; margin: 0; padding: 20px; }
        .card { background: #1c1c1e; padding: 25px; border-radius: 20px; max-width: 450px; margin: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid #333; }
        button { background: var(--brand); border: none; padding: 16px 30px; color: white; border-radius: 30px; font-weight: bold; cursor: pointer; margin: 10px; font-size: 16px; }
        .hidden { display: none; }
        #audioElement { width: 100%; margin: 20px 0; height: 50px; }
        .score-item { display: inline-block; background: #2c2c2e; padding: 5px 12px; border-radius: 15px; margin: 5px; font-size: 14px; border: 1px solid #444; }
        #statusMsg { color: #ffcc00; font-size: 12px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="card">
    <div id="setup">
        <h1>üèÜ All-Time Hits</h1>
        <input type="text" id="nameIn" placeholder="Enter Player Name">
        <br>
        <button onclick="addP()">Add Player</button>
        <div id="pList" style="margin: 15px 0;"></div>
        <button id="startBtn" class="hidden" onclick="startGame()" style="background:white; color:black;">Start Game</button>
    </div>

    <div id="game" class="hidden">
        <h2 id="turnTxt" style="color: var(--brand);"></h2>
        
        <div id="playPhase">
            <button onclick="loadNewSong()">üé≤ 1. Load Random Song</button>
            <div id="statusMsg"></div>
            <audio id="audioElement" controls playsinline></audio>
        </div>

        <div id="guessPhase" class="hidden">
            <button onclick="reveal()" id="revBtn" style="background:#444;">2. Show Song Details</button>
            
            <div id="details" class="hidden" style="background:#2c2c2e; padding:20px; border-radius:15px; margin-top:15px;">
                <h3 id="songN" style="margin:0;"></h3>
                <p id="songA" style="margin:5px 0; color:#aaa;"></p>
                <h1 id="songY" style="margin:10px 0; color:var(--brand);"></h1>
                
                <p>Did they get it right?</p>
                <button onclick="submit(true)">‚úÖ Yes</button>
                <button onclick="submit(false)" style="background:#444;">‚ùå No</button>
            </div>
        </div>
        <div id="sb" style="margin-top:25px; border-top:1px solid #333; padding-top:15px;"></div>
    </div>
</div>

<script>
    let players = [];
    let cur = 0;
    let playedSongs = [];

    // Using Direct MP3 links that bypasses most browser security blocks
    const playlist = [
        { n: "Symphony No. 5", a: "Beethoven", y: 1808, u: "https://upload.wikimedia.org/wikipedia/commons/d/d0/Beethoven_Symphony_No._5_-_I._Allegro_con_brio.ogg" },
        { n: "Clair de Lune", a: "Debussy", y: 1905, u: "https://upload.wikimedia.org/wikipedia/commons/b/bc/Claude_Debussy_-_Suite_bergamasque_-_3._Clair_de_lune.ogg" },
        { n: "The Entertainer", a: "Scott Joplin", y: 1902, u: "https://upload.wikimedia.org/wikipedia/commons/7/70/The_Entertainer.ogg" },
        { n: "Spring (The Four Seasons)", a: "Vivaldi", y: 1725, u: "https://upload.wikimedia.org/wikipedia/commons/3/3c/Vivaldi_-_The_Four_Seasons_-_Spring_-_1._Allegro.ogg" }
    ];

    const audio = document.getElementById('audioElement');
    const status = document.getElementById('statusMsg');

    function addP() {
        const input = document.getElementById('nameIn');
        if(input.value.trim()) {
            players.push({name: input.value.trim(), score: 0});
            input.value = '';
            renderP();
        }
    }

    function renderP() {
        document.getElementById('pList').innerHTML = players.map(p => `<span class="score-item">${p.name}</span>`).join('');
        if(players.length > 0) document.getElementById('startBtn').classList.remove('hidden');
    }

    function startGame() {
        document.getElementById('setup').classList.add('hidden');
        document.getElementById('game').classList.remove('hidden');
        updateUI();
    }

    function updateUI() {
        document.getElementById('turnTxt').innerText = players[cur].name + "'s Turn";
        document.getElementById('sb').innerHTML = "<b>Scores:</b> " + players.map(p => `${p.name}: ${p.score}`).join(' | ');
    }

    function loadNewSong() {
        status.innerText = "Loading audio file...";
        let available = playlist.filter(s => !playedSongs.includes(s.n));
        if (available.length === 0) { playedSongs = []; available = playlist; }

        currentSong = available[Math.floor(Math.random() * available.length)];
        playedSongs.push(currentSong.n);
        
        audio.src = currentSong.u;
        
        // When the file is ready to play
        audio.oncanplay = () => {
            status.innerText = "Ready! Press Play.";
            document.getElementById('guessPhase').classList.remove('hidden');
            document.getElementById('details').classList.add('hidden');
            document.getElementById('revBtn').classList.remove('hidden');
        };

        // If the file fails to load
        audio.onerror = () => {
            status.innerText = "Error: This song link is blocked. Try again.";
        };

        audio.load();
    }

    function reveal() {
        document.getElementById('songN').innerText = currentSong.n;
        document.getElementById('songA').innerText = currentSong.a;
        document.getElementById('songY').innerText = currentSong.y;
        document.getElementById('details').classList.remove('hidden');
        document.getElementById('revBtn').classList.add('hidden');
    }

    function submit(isCorrect) {
        if(isCorrect) players[cur].score++;
        if(players[cur].score >= 10) { alert("üèÜ " + players[cur].name + " WINS!"); location.reload(); return; }
        cur = (cur + 1) % players.length;
        document.getElementById('guessPhase').classList.add('hidden');
        status.innerText = "";
        updateUI();
    }
</script>
</body>
</html>
