<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Family Hitster Game</title>
    <style>
        :root { --brand: #1DB954; --bg: #121212; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: white; text-align: center; margin: 0; padding: 20px; }
        .card { background: #1c1c1e; padding: 25px; border-radius: 20px; max-width: 420px; margin: auto; border: 1px solid #333; }
        button { background: var(--brand); border: none; padding: 18px; color: white; border-radius: 35px; font-weight: bold; cursor: pointer; margin: 10px 0; font-size: 16px; width: 90%; }
        .hidden { display: none; }
        .score-box { font-size: 13px; opacity: 0.7; margin-top: 20px; border-top: 1px solid #333; padding-top: 15px; }
        .toggle-btn { background: #444; width: 60px; height: 60px; border-radius: 50%; font-size: 24px; display: inline-flex; align-items: center; justify-content: center; }
        input { padding: 12px; border-radius: 10px; border: 1px solid #333; width: 80%; background: #2c2c2e; color: white; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="card">
    <div id="setup">
        <h1>üèÜ Hitster Trivia</h1>
        <input type="text" id="pIn" placeholder="Enter Player Name">
        <button onclick="addP()">Add Player</button>
        <div id="pList" style="margin: 10px 0;"></div>
        <button id="startBtn" class="hidden" onclick="startGame()" style="background:white; color:black;">Start Game</button>
    </div>

    <div id="game" class="hidden">
        <h2 id="turnTxt" style="color: var(--brand);"></h2>
        
        <div id="playPhase">
            <button id="mainBtn" onclick="triggerMusic()">üéµ Play Random Song</button>
            
            <div id="audioControls" class="hidden">
                <p>Song is playing...</p>
                <button onclick="toggleAudio()" class="toggle-btn" id="toggleIcon">‚è∏</button>
                <p style="font-size: 12px; color: #888;">Tap to Play/Pause</p>
                <button onclick="revealResults()" style="background: #555;">Show Results</button>
            </div>
        </div>

        <div id="results" class="hidden">
            <h2 id="rTitle" style="margin: 0;"></h2>
            <p id="rArtist" style="color: #aaa;"></p>
            <h1 id="rYear" style="color: var(--brand);"></h1>
            
            <hr style="border: 0.5px solid #333; margin: 20px 0;">
            <p>Did they get 2+ correct?</p>
            <button onclick="processScore(true)" style="width: 45%; margin: 5px;">‚úÖ Yes</button>
            <button onclick="processScore(false)" style="background:#444; width: 45%; margin: 5px;">‚ùå No</button>
        </div>

        <div class="score-box" id="sb"></div>
    </div>
</div>

<script>
    let players = [];
    let cur = 0;
    const audio = new Audio(); // Local engine
    let currentSong = null;

    // HIGH-STABILITY MP3 LINKS
    const playlist = [
        { n: "Stayin' Alive", a: "Bee Gees", y: 1977, u: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" },
        { n: "Billie Jean", a: "Michael Jackson", y: 1982, u: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
        { n: "Imagine", a: "John Lennon", y: 1971, u: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" },
        { n: "Bohemian Rhapsody", a: "Queen", y: 1975, u: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3" }
    ];

    function addP() {
        const val = document.getElementById('pIn').value.trim();
        if(val) { players.push({name: val, score: 0}); document.getElementById('pIn').value=''; renderP(); }
    }
    function renderP() {
        document.getElementById('pList').innerText = players.map(p => p.name).join(', ');
        if(players.length > 0) document.getElementById('startBtn').classList.remove('hidden');
    }
    function startGame() {
        document.getElementById('setup').classList.add('hidden');
        document.getElementById('game').classList.remove('hidden');
        updateUI();
    }
    function updateUI() {
        document.getElementById('turnTxt').innerText = players[cur].name + "'s Turn";
        document.getElementById('sb').innerText = "Scores: " + players.map(p => `${p.name}: ${p.score}`).join(' | ');
    }

    // Step 2: Immediate Play & Toggle
    function triggerMusic() {
        currentSong = playlist[Math.floor(Math.random() * playlist.length)];
        audio.src = currentSong.u;
        audio.play();

        document.getElementById('mainBtn').classList.add('hidden');
        document.getElementById('audioControls').classList.remove('hidden');
    }

    function toggleAudio() {
        if (audio.paused) {
            audio.play();
            document.getElementById('toggleIcon').innerText = "‚è∏";
        } else {
            audio.pause();
            document.getElementById('toggleIcon').innerText = "‚ñ∂";
        }
    }

    // Step 3: Stop Playing & Reveal
    function revealResults() {
        audio.pause(); // Stop music immediately
        document.getElementById('audioControls').classList.add('hidden');
        document.getElementById('results').classList.remove('hidden');
        
        document.getElementById('rTitle').innerText = currentSong.n;
        document.getElementById('rArtist').innerText = "By: " + currentSong.a;
        document.getElementById('rYear').innerText = currentSong.y;
    }

    // Step 4: Scoring
    function processScore(isWin) {
        if(isWin) players[cur].score++;
        if(players[cur].score >= 10) { alert("Winner: " + players[cur].name); location.reload(); return; }
        
        cur = (cur + 1) % players.length;
        document.getElementById('results').classList.add('hidden');
        document.getElementById('mainBtn').classList.remove('hidden');
        updateUI();
    }
</script>
</body>
</html>
